window.HOOK_MILL_PRESETS=(()=>{const e={NONE:"",COUNTRY:"Blue-collar country tropes; diners, trucks, cheap beer; playful, not mean.",VINTAGE:"Pretend this is a 1972 lost 7-inch. [Style: Vintage Soul] [Tempo: 92] [Key: A minor]. Slightly retro diction; avoid modern brand names.",PUNK:"140â€“170 BPM, short lines, barked chant. Humor > coherence; keep lines punchy."},t={FULL:"Treat the premise with professional songwriting craft. Output Suno-ready sections. At least 3 verses, evolving chorus, and a bridge. Optional intro, pre-chorus, outro. Keep it performable straight; humor from premise and phrasing, not sloppy meter.\n\nOutput ONLY:\n[Style: <genre> | Key: <key> | Tempo: <bpm> | Time: <meter>]\n[Intro] â€¦ (optional, 1â€“2 lines)\n[Verse 1] 4â€“6 lines\n[Pre-Chorus] (optional, 2â€“4 lines)\n[Chorus] 2â€“4 lines, chantable\n[Verse 2] 4â€“6 lines\n[Chorus] slight variation / escalation\n[Verse 3] 4â€“6 lines\n[Bridge] 2â€“4 lines (contrast, set up final chorus)\n[Chorus] final, strongest (may combine prior ideas)\n[Outro] (optional, 1â€“2 lines)\n\nRules: consistent meter & syllables; internal rhyme encouraged; chorus evolves; â‰¤ ~220 words total; no explanations or extra text.",TRUNCATED:"Write a very short meme song for Suno: one [Verse] (2â€“4 lines) and one [Chorus] (2â€“4 lines). Chorus must be chantable/repeatable. â‰¤ 60 words total. Include header.\n\nOutput:\n[Style: <genre> | Key: <key> | Tempo: <bpm> | Time: <meter>]\n[Verse] â€¦\n[Chorus] â€¦\n\nNo extra sections. No explanations.",CHORUS:"Return ONLY a Suno [Chorus] (2â€“4 lines), chant-ready, â‰¤ 50 words, plus header.\n\n[Style: <genre> | Key: <key> | Tempo: <bpm> | Time: <meter>]\n[Chorus] â€¦",HOOK:"Return ONLY two shocking/funny lines followed by a tiny chant tag. â‰¤ 35 words total.\n\n[Hook]   line 1   line 2   [Chant] short chant (2â€“6 words)",TITLE:"Return ONLY a 2â€“4 word title; no colons/parentheses; PG-13; punchy.\n\n[Title] Your Title",ADD_VERSE:"You are expanding an existing song. Add exactly one [Verse] matching the given lyricsâ€™ meter/rhyme/tone. Do not modify existing text.\nOutput only the new [Verse].",ADD_BRIDGE:"You are expanding an existing song. Add exactly one [Bridge] that provides contrast and sets up the final chorus. Do not modify existing text.\nOutput only the new [Bridge]."};return{LENS_SNIPPETS:e,PRESET_SYSTEMS:t,REFINE:{DEFAULT:"You are polishing a meme-ready lyric for short-form video. Tighten meter, remove filler, improve internal rhyme, and maximize chantability. Keep the original joke/POV. If too long, trim to the shortest version that preserves the punchline. Ensure Suno sections remain intact.\nTasks:\n1. Keep or add [Style | Key | Tempo | Time].\n2. Standardize labels ([Intro] [Verse] [Pre-Chorus] [Chorus] [Bridge] [Hook] [Chant] [Outro]).\n3. Split long lines; avoid tongue-twisters.\n4. Keep PG-13 and platform-safe.\nOutput only the revised lyric in the same bracketed format. No explanations.",SHORTER:"Aggressively compress to the catchiest version (aim â‰¤ 90 words). Keep the hook; boost punch; simplify diction; preserve bracketed sections. Output lyrics only."},DEFAULTS:{model:"deepseek/deepseek-chat-v3.1:free",temperature:.9,top_p:.95,max_tokens:220,stop:["\\n\\n","[END]"],preset:"HOOK",lens:"NONE",batchSize:5,charCapOn:!0},CAPS:{FULL:{words:220,chars:2e3},TRUNCATED:{words:60,chars:600},CHORUS:{words:50,chars:450},HOOK:{words:35,chars:280},TITLE:{words:8,chars:64}},buildSystem:function(n,r){return`${t[n]}${r&&"NONE"!==r?`\n\n${e[r]}`:""}`}}})(),function(){const e="library",t=()=>new Promise((t,n)=>{if(!("indexedDB"in window))return void t(null);const r=indexedDB.open("hook-mill",1);r.onupgradeneeded=t=>{const n=r.result;if(!n.objectStoreNames.contains(e)){const t=n.createObjectStore(e,{keyPath:"id"});t.createIndex("createdAt","createdAt",{unique:!1}),t.createIndex("starred","starred",{unique:!1}),t.createIndex("model","model",{unique:!1}),t.createIndex("tags","tags",{multiEntry:!0}),t.createIndex("hash","hash",{unique:!1})}},r.onsuccess=()=>t(r.result),r.onerror=()=>t(null)}),n=(e="")=>`HM_LIB_${e}`,r={async put(r){const o=await t();return o?new Promise((t,n)=>{const a=o.transaction(e,"readwrite");a.objectStore(e).put(r),a.oncomplete=()=>t(r.id),a.onerror=()=>n(a.error)}):(localStorage.setItem(n(r.id),JSON.stringify(r)),r.id)},async get(r){const o=await t();if(!o){const e=localStorage.getItem(n(r));return e?JSON.parse(e):null}return new Promise((t,n)=>{const a=o.transaction(e,"readonly").objectStore(e).get(r);a.onsuccess=()=>t(a.result||null),a.onerror=()=>n(a.error)})},async delete(r){const o=await t();if(o)return new Promise((t,n)=>{const a=o.transaction(e,"readwrite");a.objectStore(e).delete(r),a.oncomplete=()=>t(),a.onerror=()=>n(a.error)});localStorage.removeItem(n(r))},async list(){const n=await t();if(!n){const e=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);if(n&&n.startsWith("HM_LIB_")&&"HM_LIB_"!==n){const t=localStorage.getItem(n);if(t)try{e.push(JSON.parse(t))}catch{}}}return e.sort((e,t)=>t.createdAt-e.createdAt)}return new Promise((t,r)=>{const o=n.transaction(e,"readonly").objectStore(e).getAll();o.onsuccess=()=>t((o.result||[]).sort((e,t)=>t.createdAt-e.createdAt)),o.onerror=()=>r(o.error)})},async byHash(n){const o=await t();if(!o){return(await r.list()).filter(e=>e.hash===n)}return new Promise((t,r)=>{const a=o.transaction(e,"readonly").objectStore(e).index("hash").getAll(n);a.onsuccess=()=>t(a.result||[]),a.onerror=()=>r(a.error)})},async clearAll(){const n=await t();if(!n){const e=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);n&&(n.startsWith("HM_LIB_")||n.startsWith("HM_SETTINGS_"))&&e.push(n)}return void e.forEach(e=>localStorage.removeItem(e))}await new Promise((t,r)=>{const o=n.transaction(e,"readwrite");o.objectStore(e).clear(),o.oncomplete=()=>t(),o.onerror=()=>r(o.error)}),Object.keys(localStorage).forEach(e=>{e.startsWith("HM_SETTINGS_")&&localStorage.removeItem(e)})}};window.HookMillDB=r}(),(()=>{const{DEFAULTS:e,CAPS:t,buildSystem:n,REFINE:r}=window.HOOK_MILL_PRESETS;!function(){const e=document.documentElement,t=document.getElementById("btn-theme");if(!t)return;const n=()=>{t.textContent="dark"===e.dataset.theme?"â˜€ï¸":"ðŸŒ™"};n(),t.addEventListener("click",()=>{e.dataset.theme="dark"===e.dataset.theme?"light":"dark",n()})}();const o=(e,t=document)=>t.querySelector(e),a=(e,t=document)=>Array.from(t.querySelectorAll(e)),s=(e,t="")=>{const n=document.createElement("div");n.className=`toast ${t}`,n.textContent=e,o("#toasts").appendChild(n),setTimeout(()=>n.remove(),3500)},i=e=>Math.max(1,Math.round(e.length/4));function l(){return`${Date.now().toString(36).padStart(10,"0")}${Array.from(crypto.getRandomValues(new Uint8Array(10))).map(e=>e.toString(36).padStart(2,"0")).join("").slice(0,12)}`}function c(e){navigator.clipboard.writeText(e).then(()=>s("Copied","good"),()=>s("Copy failed","bad"))}function d(e,t){const n=document.createElement("a"),r=new Blob([t],{type:"text/plain;charset=utf-8"});n.href=URL.createObjectURL(r),n.download=e,n.click(),setTimeout(()=>URL.revokeObjectURL(n.href),5e3)}const u="HM_SETTINGS_V1",p={load(){const t=localStorage.getItem(u);let n=t?JSON.parse(t):{};return n={...e,...n},o("#api-key").value=n.apiKey||"",o("#model").value=n.model,o("#temperature").value=n.temperature,o("#top_p").value=n.top_p,o("#max_tokens").value=n.max_tokens,o("#stop_tokens").value=(n.stop||[]).join(","),o("#val-temperature").textContent=n.temperature,o("#val-top_p").textContent=n.top_p,o("#val-max_tokens").textContent=n.max_tokens,a('input[name="default-preset"]').forEach(e=>e.checked=e.value===n.preset),a('input[name="default-lens"]').forEach(e=>e.checked=e.value===n.lens),o("#nsfw_lean").checked=!!n.nsfw,o("#char_cap").checked=!!n.charCapOn,h(),b(),g(n.preset),a('input[name="lens"]').forEach(e=>e.checked=e.value===n.lens),n},readFromUI(){const t=o("#stop_tokens").value.split(",").map(e=>e.trim()).filter(Boolean);return{apiKey:o("#api-key").value.trim(),model:o("#model").value.trim()||e.model,temperature:+o("#temperature").value,top_p:+o("#top_p").value,max_tokens:+o("#max_tokens").value,stop:t,preset:o('input[name="default-preset"]:checked')?.value||e.preset,lens:o('input[name="default-lens"]:checked')?.value||e.lens,nsfw:o("#nsfw_lean").checked,charCapOn:o("#char_cap").checked}},save(){const e=p.readFromUI();return localStorage.setItem(u,JSON.stringify(e)),s("Settings saved","good"),h(),b(),e},get(){const t=localStorage.getItem(u);return{...e,...t?JSON.parse(t):{}}}},m={running:!1,aborter:null,currentPreset:e.preset,currentLens:e.lens,lastOutput:"",lastSystem:"",lastPrompt:"",lastParams:{},selectedItemId:null,timerStart:0,elapsedTimer:null};function h(){o("#model-badge").textContent=p.get().model}function b(e){const t=o("#conn-dot");t.classList.remove("conn-ok","conn-warn","conn-bad");const n=!!p.get().apiKey;"bad"===e?t.classList.add("conn-bad"):"ok"===e||n?t.classList.add("conn-ok"):t.classList.add("conn-warn")}function g(e){m.currentPreset=e,a(".preset-tabs button").forEach(t=>{t.setAttribute("aria-selected",t.dataset.preset===e?"true":"false")})}function f(e){a(".subtabs button").forEach(t=>t.setAttribute("aria-selected",t.dataset.view===e?"true":"false")),o("#out-formatted").hidden="formatted"!==e,o("#out-plain").hidden="plain"!==e,o("#out-captions").hidden="captions"!==e}function y(){clearInterval(m.elapsedTimer)}function w(){const e=o("#seed").value,t=e.length,n=i(e);o("#status-length").textContent=`${t} chars â€¢ ~${n} tok`}function S(e){if(!p.get().charCapOn)return e;const n=t[m.currentPreset]||t.FULL,r=e.trim().split(/\s+/);return r.length>n.words?r.slice(0,n.words).join(" "):e.length>n.chars?e.slice(0,n.chars):e}function v(e){const t=e.toLowerCase(),n=new Set;return/\b(truck|chevy|beer|boots|county|barstool|whiskey|mud)\b/.test(t)&&n.add("#country"),/\b(vintage|needle|vinyl|spindle|jukebox|cassette|tape)\b/.test(t)&&n.add("#vintage"),/\b(yell|mosh|pit|leather|amp|snare)\b/.test(t)&&n.add("#punk"),/\b(grandma|uncle|neighbor|teacher)\b/.test(t)&&n.add("#character"),/\b(vape|tiktok|meme|wifi|dm)\b/.test(t)&&n.add("#meme"),Array.from(n)}function k(e){m.lastOutput=e,o("#out-formatted").textContent=e,o("#out-plain").value=e;const t=e.split(/\r?\n/).map(e=>e.trim()).filter(Boolean).slice(0,2).join("\n");o("#out-captions").textContent=t;const n=!!x(e),r=!!O(e);o("#btn-copy-chorus").disabled=!n,o("#btn-copy-hook").disabled=!r}let E=null;const _=k;function x(e){const t=e.match(/\[Chorus\][\s\S]*?(?=\n\[[A-Z][^\]]+\]|\s*$)/);return t?t[0].trim():""}function O(e){const t=e.match(/\[Hook\][^\[]+/),n=e.match(/\[Chant\][^\[]+/);return t||n?`${t?t[0].trim():""}${t&&n?"\n":""}${n?n[0].trim():""}`.trim():""}function C(e,t,n=""){const r=new Date;return`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}_${String(r.getHours()).padStart(2,"0")}${String(r.getMinutes()).padStart(2,"0")}_${e}_${t}_${(n||o("#seed").value).toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"").slice(0,40)||"untitled"}.txt`}async function T({system:e,user:t,params:n,signal:r}){const{apiKey:o,model:a}=p.get();if(!o)throw new Error("Missing OpenRouter API Key");const s={model:a,temperature:n.temperature,top_p:n.top_p,max_tokens:n.max_tokens,stop:n.stop,stream:!0,messages:[{role:"system",content:e},{role:"user",content:t}]},i={Authorization:`Bearer ${o}`,"Content-Type":"application/json"};let l=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:i,body:JSON.stringify(s),signal:r});if((429===l.status||l.status>=500)&&(await new Promise(e=>setTimeout(e,1e3)),l=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:i,body:JSON.stringify(s),signal:r})),!l.ok){const e=await l.text().catch(()=>l.statusText);throw new Error(e||`HTTP ${l.status}`)}const c=l.body.getReader(),d=new TextDecoder;let u="",m="";const h=(n.stop||[]).filter(Boolean),b=()=>h.some(e=>m.includes(e));for(;;){const{done:e,value:t}=await c.read();if(e)break;u+=d.decode(t,{stream:!0});const n=u.split("\n\n");u=n.pop()||"";for(const e of n){const t=e.split("\n").map(e=>e.trim()).filter(Boolean);for(const e of t){if(!e.startsWith("data:"))continue;const t=e.slice(5).trim();if("[DONE]"===t){c.cancel();break}try{const e=JSON.parse(t),n=e.choices?.[0]?.delta?.content??"";if(n){m+=n;const e=S(m);if(m=e,k(m),b()){try{c.cancel()}catch{}return m}}}catch(e){}}}}return m}async function L({batch:e=1}={}){if(m.running)return;const t=o("#seed").value.trim();if(!t)return void s("Enter a topic or seed first.","bad");const r=p.get();m.lastSystem=n(m.currentPreset,m.currentLens),m.lastPrompt=S(t),m.lastParams={temperature:r.temperature,top_p:r.top_p,max_tokens:r.max_tokens,stop:r.stop},o("#btn-stop").disabled=!1,o("#btn-generate").disabled=!0,o("#btn-batch").disabled=!0,m.running=!0,b("ok"),m.timerStart=performance.now(),clearInterval(m.elapsedTimer),m.elapsedTimer=setInterval(()=>{const e=(performance.now()-m.timerStart)/1e3;o("#status-elapsed").textContent=`${e.toFixed(1)}s`},100);const a=[];for(let t=0;t<e&&m.running;t++){k("");const e=new AbortController;m.aborter=e;try{const t=await T({system:m.lastSystem,user:m.lastPrompt,params:m.lastParams,signal:e.signal});a.push(t),await D(t)}catch(t){if(e.signal.aborted){s("Stopped","warn");break}b("bad"),s(`Error: ${t.message||t}`,"bad")}}m.running=!1,o("#btn-stop").disabled=!0,o("#btn-generate").disabled=!1,o("#btn-batch").disabled=!1,y()}function A(){if(m.aborter)try{m.aborter.abort()}catch{}m.running=!1,o("#btn-stop").disabled=!0,o("#btn-generate").disabled=!1,o("#btn-batch").disabled=!1,y()}async function D(e){if(!e?.trim())return;const t=p.get(),n=m.currentPreset,r=m.currentLens,a=Date.now(),i={...m.lastParams},c=await async function(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}(e),d=await HookMillDB.byHash(c);let u=l();d.length&&s("Duplicateâ€”saved w/ timestamp v2","warn");const h={id:u,createdAt:a,model:t.model,preset:n,lens:r,system:m.lastSystem,prompt:m.lastPrompt,params:i,output:e,hash:c,tags:v(e),starred:!1,notes:"",refinements:[]};return await HookMillDB.put(h),N(),o("#library-panel").hidden||I(),u}async function I(){const e=await HookMillDB.list(),t=o("#lib-search").value.trim().toLowerCase(),n=o("#lib-tag-filter").value,r=o("#lib-model-filter").value,a=o("#lib-starred-only").checked,i=e.filter(e=>{if(a&&!e.starred)return!1;if(n&&!(e.tags||[]).includes(n))return!1;if(r&&e.model!==r)return!1;if(!t)return!0;return[e.output,e.prompt,e.model,e.tags?.join(" ")].join("\n").toLowerCase().includes(t)}),l=o("#lib-list");l.innerHTML="";const u=o("#lib-card-template");i.forEach(e=>{const t=u.content.firstElementChild.cloneNode(!0);t.dataset.id=e.id;const n=(e.output||"").split(/\r?\n/).find(e=>e.trim())||"(untitled)";var r;o(".lib-title",t).textContent=n.slice(0,120),o(".badge.preset",t).textContent=e.preset,o(".badge.lens",t).textContent=e.lens,o(".badge.model",t).textContent=e.model,o(".time",t).textContent=(r=e.createdAt,new Date(r).toLocaleString()),o(".lib-output",t).textContent=e.output,o(".tag-editor",t).value=(e.tags||[]).join(", ");const a=o(".star",t);a.textContent=e.starred?"â˜…":"â˜†",a.onclick=async()=>{e.starred=!e.starred,a.textContent=e.starred?"â˜…":"â˜†",await HookMillDB.put(e)},o(".copy",t).onclick=()=>c(e.output),o(".export",t).onclick=()=>{d(C(e.preset,e.lens,n),e.output)},o(".delete",t).onclick=async()=>{await HookMillDB.delete(e.id),I(),s("Deleted","warn")},o(".tag-editor",t).addEventListener("change",async t=>{e.tags=t.target.value.split(/,+/).map(e=>e.trim()).filter(Boolean),await HookMillDB.put(e),N()}),o(".refine",t).onclick=()=>R("Refine",e,"REFINE_DEFAULT"),o(".refine2",t).onclick=()=>R("Refine â€” Shorter & Louder",e,"REFINE_SHORTER"),o(".add-verse",t).onclick=()=>R("Add Verse",e,"ADD_VERSE"),o(".add-bridge",t).onclick=()=>R("Add Bridge",e,"ADD_BRIDGE"),l.appendChild(t)})}async function N(){const e=await HookMillDB.list(),t=o("#lib-tag-filter"),n=o("#lib-model-filter"),r=new Set,a=new Set;e.forEach(e=>{(e.tags||[]).forEach(e=>r.add(e)),e.model&&a.add(e.model)});const s=t.value,i=n.value;t.innerHTML="";const l=document.createElement("option");l.value="",l.textContent="All Tags",t.appendChild(l),Array.from(r).sort().forEach(e=>{const n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)}),n.innerHTML="";const c=document.createElement("option");c.value="",c.textContent="All Models",n.appendChild(c),Array.from(a).sort().forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,n.appendChild(t)}),t.value=s||"",n.value=i||""}function R(e,t,n){o("#mini-title").textContent=e,o("#mini-stream").textContent="",o("#mini-modal-overlay").hidden=!1,o("#mini-modal").hidden=!1,m.selectedItemId=t.id;const a=p.get();let i,c;"REFINE_DEFAULT"===n?(i=r.DEFAULT,c=t.output):"REFINE_SHORTER"===n?(i=r.SHORTER,c=t.output):"ADD_VERSE"===n?(i=window.HOOK_MILL_PRESETS.PRESET_SYSTEMS.ADD_VERSE,c=t.output):"ADD_BRIDGE"===n?(i=window.HOOK_MILL_PRESETS.PRESET_SYSTEMS.ADD_BRIDGE,c=t.output):(i="You are a helpful editor.",c=t.output);const d=new AbortController;m.aborter=d,o("#mini-save").disabled=!0,T({system:i,user:c,params:{temperature:a.temperature,top_p:a.top_p,max_tokens:a.max_tokens,stop:a.stop},signal:d.signal}).then(async r=>{o("#mini-save").disabled=!1,o("#mini-save").onclick=async()=>{const c=await HookMillDB.get(t.id),d={id:l(),createdAt:Date.now(),model:a.model,system:i,output:r,label:e};c.refinements=c.refinements||[],c.refinements.push(d),"ADD_VERSE"!==n&&"ADD_BRIDGE"!==n||(c.output=`${c.output.trim()}\n${r.startsWith("[")?"\n":""}${r}`.trim()),await HookMillDB.put(c),s("Saved","good"),o("#mini-modal-overlay").hidden=!0,o("#mini-modal").hidden=!0,window.__setOutput=void 0,o("#mini-save").disabled=!1,m.aborter=null,m.selectedItemId=null,I()}}).catch(e=>{s(`Error: ${e.message||e}`,"bad")});new MutationObserver(()=>{o("#mini-stream").textContent}).observe(o("#mini-stream"),{childList:!0,characterData:!0,subtree:!0}),E=e=>{o("#mini-stream").textContent=e},window.__setOutput=E}function P(){o("#settings-overlay").hidden=!0,o("#settings-drawer").hidden=!0,o("#btn-settings").setAttribute("aria-expanded","false")}window.__setOutput=void 0,k=function(e){return window.__setOutput?window.__setOutput(e):_(e)},a(".preset-tabs button").forEach(e=>{e.addEventListener("click",()=>{g(e.dataset.preset);const t=p.get();t.preset=m.currentPreset,localStorage.setItem(u,JSON.stringify(t))})}),a('input[name="lens"]').forEach(e=>{e.addEventListener("change",()=>{m.currentLens=e.value;const t=p.get();t.lens=m.currentLens,localStorage.setItem(u,JSON.stringify(t))})}),o("#btn-settings").onclick=()=>{o("#settings-overlay").hidden=!1,o("#settings-drawer").hidden=!1,o("#btn-settings").setAttribute("aria-expanded","true"),p.load()},o("#btn-close-settings").onclick=P,o("#settings-overlay").onclick=P,o("#btn-save-settings").onclick=()=>p.save(),o("#btn-clear-data").onclick=async()=>{confirm("Clear ALL data (settings + library)?")&&(await HookMillDB.clearAll(),p.load(),I(),s("All data cleared","warn"))},o("#btn-library").onclick=async()=>{const e=o("#library-panel"),t=e.hidden;e.hidden=!t,o("#btn-library").setAttribute("aria-expanded",t?"true":"false"),t&&(await N(),await I(),o("#lib-search").focus())},o("#btn-close-library").onclick=()=>{o("#library-panel").hidden=!0,o("#btn-library").setAttribute("aria-expanded","false")},o("#lib-search").addEventListener("input",I),o("#lib-tag-filter").addEventListener("change",I),o("#lib-model-filter").addEventListener("change",I),o("#lib-starred-only").addEventListener("change",I),o("#btn-export-starred").onclick=async function(){const e=(await HookMillDB.list()).filter(e=>e.starred);if(!e.length)return void s("No starred items","warn");const t=e.map(e=>e.output).join("\n\n---\n\n");d(`starred_${(new Date).toISOString().slice(0,16).replace(/[:T]/g,"-")}.txt`,t)},o("#seed").addEventListener("input",w),o("#btn-generate").onclick=()=>L({batch:1}),o("#btn-batch").onclick=()=>{return L({batch:(e=p.get().batchSize,t=1,n=10,Math.max(t,Math.min(n,e)))});var e,t,n},o("#btn-stop").onclick=A,o("#btn-new").onclick=()=>{m.running&&A(),o("#seed").value="",k(""),w(),o("#seed").focus()},a(".subtabs button").forEach(e=>{e.onclick=()=>f(e.dataset.view)}),o("#btn-copy-all").onclick=()=>c(m.lastOutput||""),o("#btn-copy-chorus").onclick=()=>{const e=x(m.lastOutput||"");if(!e)return s("No [Chorus] found","warn");c(e)},o("#btn-copy-hook").onclick=()=>{const e=O(m.lastOutput||"");if(!e)return s("No [Hook]/[Chant] found","warn");c(e)},o("#btn-copy-captions").onclick=()=>{const e=o("#out-captions").textContent||"";if(!e.trim())return s("No captions","warn");c(e)},o("#btn-export").onclick=()=>{d(C(m.currentPreset,m.currentLens,(m.lastOutput||"").split("\n")[0]||""),m.lastOutput||"")},o("#btn-save-notes").onclick=async()=>{if(!m.lastOutput?.trim())return s("Nothing to save","warn");await D(m.lastOutput);s("Saved to Library","good")},document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&"Enter"===e.key?(e.preventDefault(),o("#btn-generate").click()):"Escape"===e.key?(e.preventDefault(),o("#btn-stop").click()):"/"===e.key?o("#library-panel").hidden||(e.preventDefault(),o("#lib-search").focus()):"."===e.key&&document.activeElement!==o("#seed")&&(e.preventDefault(),o("#seed").focus())}),o("#api-key").addEventListener("input",()=>b()),f("formatted"),p.load(),w(),k("");setInterval(()=>{const e=m.lastOutput||"",t=(e.trim().match(/\b[\wâ€™']+\b/g)||[]).length;const n=i(e);o("#status-msg").textContent=`${t} words â€¢ ~${n} tok`},500)})();
